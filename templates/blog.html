<!-- blog.html -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script>
			tailwind.config = {
				darkMode: 'class',
			};
		</script>

		<!-- SEO and Social Media Meta Tags -->
		{% set page_title = "Ollayor's Blog - Technical Articles & Insights" %} {% set page_description = "Technical and
		non-technical articles by Ollayor Maxammadnabiyev. Exploring software engineering, programming, mathematics, and
		technology insights." %} {% include 'seo_meta.html' %}

		<!-- Preconnect to external domains -->
		<link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin />
		<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
		<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

		<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}" />
		<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon-optimized.ico') }}" />
		<script src="https://cdn.tailwindcss.com"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
		<link
			href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<!-- Enhanced blog styling -->
		<link rel="stylesheet" href="{{ url_for('static', filename='blog-styles.css') }}" />
		{% include 'analytics.html' %}
	</head>

	<body class="font-mono bg-white dark:bg-black text-gray-900 dark:text-gray-100 min-h-screen flex flex-col relative">
		<!-- Background Gradients for Blur Effect -->
		<div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
			<div
				class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 dark:bg-purple-500/10 blur-[120px]"
			></div>
			<div
				class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 dark:bg-blue-500/10 blur-[120px]"
			></div>
		</div>

		<!-- Minimalist Header -->
		<header
			class="w-full max-w-4xl mx-auto px-6 py-8 flex justify-between items-center border-b border-gray-200/20 dark:border-white/10"
		>
			<a
				href="/"
				class="text-xl font-bold tracking-tight hover:text-gray-600 dark:hover:text-gray-300 transition-colors"
				>ollayor</a
			>
			<nav class="flex gap-6 text-sm">
				<a href="/blog" class="text-gray-900 dark:text-gray-100 font-medium">Essays</a>
				<a
					href="/projects"
					class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 transition-colors"
					>Projects</a
				>
				<a
					href="{{ url_for('static', filename='media/Olloyor_s_resume.pdf') }}"
					target="_blank"
					class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 transition-colors"
					>CV</a
				>
			</nav>
		</header>

		<div class="w-full max-w-4xl mx-auto px-6 flex-grow py-12">
			<!-- Hero Section -->
			<section class="mb-16">
				<h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-6 leading-tight">
					Thoughts on design,<br />technology & life.
				</h1>
				<p class="text-lg text-gray-600 dark:text-gray-400 max-w-xl leading-relaxed">
					A collection of essays and observations on the things that matter.
				</p>
			</section>

			<main>
				{% if articles %}
				<div
					id="article-list"
					class="space-y-0"
					data-per-page="{{ per_page | default(6) }}"
					data-total="{{ total_articles | default(0) }}"
					data-has-more="{{ 'true' if has_more else 'false' }}"
				>
					{% for article in articles %}
					<a
						href="{{ url_for('article', slug=article.slug) }}"
						class="group block py-8 border-b border-gray-200/20 dark:border-white/10 hover:border-gray-300 dark:hover:border-white/20 transition-colors"
					>
						<article class="grid grid-cols-[32px_1fr] md:grid-cols-[48px_1fr] gap-4 md:gap-6">
							<span
								class="text-sm text-gray-400 dark:text-gray-600 font-mono pt-1 group-hover:text-gray-900 dark:group-hover:text-gray-100 transition-colors"
							>
								{{ "%02d" | format(loop.index) }}
							</span>
							<div class="space-y-3">
								<h3
									class="text-2xl font-bold text-gray-900 dark:text-gray-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"
								>
									{{ article.title }}
								</h3>
								{% if article.get_summary(200) %}
								<p class="text-gray-600 dark:text-gray-400 leading-relaxed text-sm">
									{{ article.get_summary(200) | safe }}
								</p>
								{% endif %}
								<div
									class="flex items-center gap-3 text-xs text-gray-500 dark:text-gray-500 uppercase tracking-wider font-medium mt-2"
								>
									<span>{{ article.date_published.strftime('%b %d, %Y') }}</span>
									<span>·</span>
									<span>{{ article.get_reading_time() }} min read</span>
								</div>
							</div>
						</article>
					</a>
					{% endfor %}
				</div>

				<div
					id="infinite-scroll-loading"
					class="items-center justify-center mt-12 text-gray-500 dark:text-gray-400 hidden"
				>
					<i class="fas fa-spinner fa-spin mr-2"></i>
					<span>Loading more...</span>
				</div>
				{% if has_more %}
				<div id="infinite-scroll-trigger" class="h-1"></div>
				{% endif %} {% else %}
				<div class="py-12 text-center">
					<p class="text-gray-600 dark:text-gray-400">No articles found.</p>
				</div>
				{% endif %}
			</main>
		</div>

		<!-- Minimalist Footer -->
		<footer
			class="w-full max-w-4xl mx-auto px-6 py-8 mt-auto border-t border-gray-200/20 dark:border-white/10 flex flex-col md:flex-row justify-between items-center gap-4"
		>
			<div class="flex items-center gap-4">
				<span class="font-bold text-sm">ollayor</span>
				<span class="text-xs text-gray-500">© 2025</span>
			</div>
			<div class="flex gap-6 text-sm">
				<a
					href="https://twitter.com/olllayor"
					target="_blank"
					class="text-gray-500 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
					>Twitter</a
				>
				<a
					href="https://github.com/olllayor"
					target="_blank"
					class="text-gray-500 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
					>GitHub</a
				>
				<a
					href="https://t.me/olllayor"
					class="text-gray-500 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
					>Telegram</a
				>
			</div>
		</footer>

		<script>
			// Simplified Infinite Scroll Script
			document.addEventListener('DOMContentLoaded', () => {
				const list = document.getElementById('article-list');
				const trigger = document.getElementById('infinite-scroll-trigger');
				const loader = document.getElementById('infinite-scroll-loading');
				if (!list || !trigger) return;

				let currentPage = 1;
				const perPage = parseInt(list.dataset.perPage || '6', 10);
				let totalArticles = parseInt(list.dataset.total || '0', 10);
				let hasMore = list.dataset.hasMore === 'true';
				let loading = false;

				const observer = new IntersectionObserver(
					(entries) => {
						if (entries[0].isIntersecting) fetchNextPage();
					},
					{ rootMargin: '200px' },
				);

				observer.observe(trigger);

				async function fetchNextPage() {
					if (loading || !hasMore) return;
					loading = true;
					loader?.classList.remove('hidden');
					loader?.classList.add('flex');

					try {
						const response = await fetch(`/api/articles?page=${currentPage + 1}&per_page=${perPage}`);
						const payload = await response.json();

						if (!payload.articles?.length) {
							hasMore = false;
							observer.disconnect();
							trigger.remove();
							return;
						}

						payload.articles.forEach((article, index) => {
							const globalIndex = currentPage * perPage + index + 1;
							const formattedIndex = String(globalIndex).padStart(2, '0');

							const link = document.createElement('a');
							link.href = `/blog/${article.slug}`;
							link.className =
								'group block py-8 border-b border-gray-200/20 dark:border-white/10 hover:border-gray-300 dark:hover:border-white/20 transition-colors';

							link.innerHTML = `
								<article class="grid grid-cols-[32px_1fr] md:grid-cols-[48px_1fr] gap-4 md:gap-6">
									<span class="text-sm text-gray-400 dark:text-gray-600 font-mono pt-1 group-hover:text-gray-900 dark:group-hover:text-gray-100 transition-colors">
										${formattedIndex}
									</span>
									<div class="space-y-3">
										<h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
											${article.title}
										</h3>
										<p class="text-gray-600 dark:text-gray-400 leading-relaxed text-sm">
											${article.summary || ''}
										</p>
										<div class="flex items-center gap-3 text-xs text-gray-500 dark:text-gray-500 uppercase tracking-wider font-medium mt-2">
											<span>${article.published_on}</span>
											<span>·</span>
											<span>${article.reading_time} min read</span>
										</div>
									</div>
								</article>
							`;
							list.appendChild(link);
						});

						currentPage++;
						hasMore = payload.has_more;
						if (!hasMore) {
							observer.disconnect();
							trigger.remove();
						}
					} catch (e) {
						console.error(e);
					} finally {
						loading = false;
						loader?.classList.add('hidden');
						loader?.classList.remove('flex');
					}
				}
			});
		</script>
	</body>
</html>
