<!-- article.html -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script>
			tailwind.config = { darkMode: 'class' };
		</script>

		<!-- Preconnect to external domains -->
		<link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin />
		<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
		<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

		<script src="https://cdn.tailwindcss.com"></script>

		<!-- SEO and Social Media Meta Tags for Articles -->
		{% set page_title = article.title + " - Ollayor's Blog" %} {% set page_description = article.get_summary(160) %} {%
		set page_type = "article" %} {% set page_image = first_image if first_image else url_for('static',
		filename='myself-social-optimized.jpg', _external=True) %} {% set article_date = article.date_published.isoformat()
		if article.date_published else "" %} {% set article_modified = article.date_updated.isoformat() if
		article.date_updated else "" %} {% include 'seo_meta.html' %}
		<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}" />
		<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon-optimized.ico') }}" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
		<link
			href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<!-- Enhanced blog styling -->
		<link rel="stylesheet" href="{{ url_for('static', filename='blog-styles.css') }}" />
		{% include 'analytics.html' %}

		<!-- Syntax highlighting runtime (no theme CSS; we style via blog-styles.css) -->
		<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
	</head>

	<body class="font-mono bg-white dark:bg-black text-gray-900 dark:text-gray-100 min-h-screen flex flex-col relative">
		<!-- Background Gradients for Blur Effect -->
		<div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
			<div
				class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] rounded-full bg-purple-500/5 dark:bg-purple-500/10 blur-[120px]"
			></div>
			<div
				class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] rounded-full bg-blue-500/5 dark:bg-blue-500/10 blur-[120px]"
			></div>
		</div>

		<!-- Reading progress indicator -->
		<div id="reading-progress" class="fixed top-0 left-0 w-full h-0.5 bg-transparent z-50">
			<div
				class="h-full bg-blue-500/50 dark:bg-blue-400/50 transition-all duration-150 ease-out"
				style="width: 0%"
			></div>
		</div>

		<!-- Minimalist Header -->
		<header
			class="w-full max-w-4xl mx-auto px-6 py-8 flex justify-between items-center border-b border-gray-200/20 dark:border-white/10"
		>
			<a
				href="/"
				class="text-xl font-bold tracking-tight hover:text-gray-600 dark:hover:text-gray-300 transition-colors"
				>ollayor</a
			>
			<nav class="flex gap-6 text-sm">
				<a href="/blog" class="text-gray-900 dark:text-gray-100 font-medium">Essays</a>
				<a
					href="/projects"
					class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 transition-colors"
					>Projects</a
				>
				<a
					href="{{ url_for('static', filename='media/Olloyor_s_resume.pdf') }}"
					target="_blank"
					class="text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100 transition-colors"
					>CV</a
				>
			</nav>
		</header>

		<main class="flex-grow w-full max-w-3xl mx-auto px-6 py-12">
			{% if article %}
			<article>
				<header class="mb-12 text-center">
					<div
						class="flex items-center justify-center gap-3 text-xs text-gray-500 dark:text-gray-500 uppercase tracking-wider font-medium mb-6"
					>
						<span>{{ article.date_published.strftime('%B %d, %Y') }}</span>
						<span>·</span>
						<span>{{ article.get_reading_time() }} min read</span>
					</div>
					<h1 class="text-3xl md:text-4xl font-bold tracking-tight text-gray-900 dark:text-gray-100 mb-6 leading-tight">
						{{ article.title }}
					</h1>
					<div class="flex items-center justify-center gap-2 text-sm text-gray-500">
						<i class="far fa-eye"></i>
						<span>{{ view_count }} views</span>
					</div>
				</header>

				<div
					class="blog-content prose prose-gray dark:prose-invert max-w-none prose-headings:font-bold prose-headings:tracking-tight prose-a:text-blue-600 dark:prose-a:text-blue-400 hover:prose-a:text-blue-500 prose-img:rounded-xl prose-img:shadow-lg prose-pre:bg-gray-50 dark:prose-pre:bg-gray-900/50 prose-pre:border prose-pre:border-gray-200/50 dark:prose-pre:border-white/10 prose-pre:backdrop-blur-sm"
				>
					{{ article.content | safe }}
				</div>
			</article>
			{% else %}
			<div class="text-center py-20">
				<p class="text-gray-600 dark:text-gray-400">Article not found.</p>
				<a href="/blog" class="text-blue-500 hover:underline mt-4 inline-block">Back to essays</a>
			</div>
			{% endif %}
		</main>

		<!-- Minimalist Footer -->
		<footer
			class="w-full max-w-4xl mx-auto px-6 py-8 mt-auto border-t border-gray-200/20 dark:border-white/10 flex flex-col md:flex-row justify-between items-center gap-4"
		>
			<div class="flex items-center gap-4">
				<span class="font-bold text-sm">ollayor</span>
				<span class="text-xs text-gray-500">© 2025</span>
			</div>
			<div class="flex gap-6 text-sm">
				<a
					href="https://twitter.com/olllayor"
					target="_blank"
					class="text-gray-500 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
					>Twitter</a
				>
				<a
					href="https://github.com/olllayor"
					target="_blank"
					class="text-gray-500 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
					>GitHub</a
				>
				<a href="/rss" class="text-gray-500 hover:text-gray-900 dark:hover:text-gray-100 transition-colors">RSS</a>
			</div>
		</footer>

		<script>
			// Add copy buttons to code blocks inside article content
			document.addEventListener('DOMContentLoaded', () => {
				const container = document.querySelector('.blog-content');
				if (!container) return;

				// Reading progress indicator
				const progressBar = document.querySelector('#reading-progress div');
				if (progressBar) {
					function updateProgress() {
						const article = document.querySelector('article');
						if (!article) return;

						const articleTop = article.offsetTop;
						const articleHeight = article.offsetHeight;
						const scrollTop = window.pageYOffset;
						const windowHeight = window.innerHeight;

						// Adjusted calculation for better accuracy
						const totalScroll = articleHeight - windowHeight + articleTop;
						let progress = 0;

						if (scrollTop > 0) {
							progress = (scrollTop / totalScroll) * 100;
						}

						progress = Math.min(100, Math.max(0, progress));
						progressBar.style.width = progress + '%';
					}

					window.addEventListener('scroll', updateProgress);
					window.addEventListener('resize', updateProgress);
					updateProgress(); // Initial call
				}

				// Backfill missing alt/title on content images for accessibility/SEO
				const imgs = container.querySelectorAll('img');
				imgs.forEach((img) => {
					const fallback = '{{ article.title|e }}';
					if (!img.getAttribute('alt') || img.getAttribute('alt').trim() === '') {
						img.setAttribute('alt', fallback);
					}
					if (!img.getAttribute('title') || img.getAttribute('title').trim() === '') {
						img.setAttribute('title', fallback);
					}
				});
				const blocks = container.querySelectorAll('pre');
				blocks.forEach((pre) => {
					// Avoid duplicates
					if (pre.querySelector('.copy-btn')) return;
					const btn = document.createElement('button');
					btn.className = 'copy-btn';
					btn.type = 'button';
					btn.textContent = 'Copy';
					btn.addEventListener('click', async () => {
						const code = pre.querySelector('code');
						const text = code ? code.innerText : pre.innerText;
						try {
							await navigator.clipboard.writeText(text);
							btn.textContent = 'Copied!';
							btn.classList.add('copied');
							setTimeout(() => {
								btn.textContent = 'Copy';
								btn.classList.remove('copied');
							}, 1500);
						} catch (e) {
							btn.textContent = 'Failed';
							setTimeout(() => (btn.textContent = 'Copy'), 1500);
						}
					});
					pre.appendChild(btn);
				});

				// Initialize highlight.js if available and add a small language badge like ChatGPT
				try {
					if (window.hljs && typeof window.hljs.highlightAll === 'function') {
						window.hljs.highlightAll();
					}
				} catch (_) {}

				// Add language badges to code blocks
				blocks.forEach((pre) => {
					const code = pre.querySelector('code');
					if (!code) return;
					// Detect language from class names like language-js, lang-python, or hljs language
					const classes = (code.className || '').split(/\s+/);
					let lang = classes
						.map((c) => {
							if (c.startsWith('language-')) return c.replace('language-', '');
							if (c.startsWith('lang-')) return c.replace('lang-', '');
							return null;
						})
						.filter(Boolean)[0];
					// Some markdown renderers add classes like "python" directly
					if (!lang) {
						const simpleLang = classes.find((c) =>
							/^(bash|sh|zsh|shell|json|yaml|yml|toml|ini|js|ts|tsx|jsx|javascript|typescript|python|py|go|rust|rs|java|kotlin|swift|c|cpp|cs|php|ruby|rb|sql|html|css|scss|sass|md|markdown)$/.test(
								c,
							),
						);
						lang = simpleLang || '';
					}
					if (!lang) return;
					// Avoid duplicate badges
					if (pre.querySelector('.lang-badge')) return;
					const badge = document.createElement('span');
					badge.className = 'lang-badge';
					badge.textContent = lang.toUpperCase();
					pre.appendChild(badge);
				});
			});
		</script>

		{% if article %}
		<!-- Buy Me a Coffee Widget: only on article pages -->
		<script
			data-name="BMC-Widget"
			data-cfasync="false"
			src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
			data-id="ollayor"
			data-description="Support me on Buy me a coffee!"
			data-message="Tip me a coffee — thank you!"
			data-color="#5F7FFF"
			data-position="Right"
			data-x_margin="15"
			data-y_margin="15"
		></script>
		{% endif %}
	</body>
</html>
