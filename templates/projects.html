<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!-- SEO and Social Media Meta Tags -->
		{% set page_title = "Projects - Ollayor Maxammadnabiyev" %} {% set page_description = "Software development projects
		by Ollayor Maxammadnabiyev. Showcasing web applications, tools, and innovative solutions built with modern
		technologies." %} {% include 'seo_meta.html' %}

		<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}" />
		<script src="https://cdn.tailwindcss.com"></script>
		<link
			href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
			integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		/>
		<style>
			.project-description.desc-clamped {
				display: -webkit-box;
				-webkit-line-clamp: 4;
				-webkit-box-orient: vertical;
				overflow: hidden;
			}
		</style>
		{% include 'analytics.html' %}
	</head>

	<body class="font-inter bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col">
		{% include 'header.html' %}
		<main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-12">
			<h1
				class="text-center text-4xl font-bold text-gray-800 dark:text-gray-200 mb-12"
				style="font-family: 'Geist Mono', monospace"
			>
				My Projects
			</h1>

			{% if projects %}
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
				{% for project in projects %}
				<div
					class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105"
				>
					{% if project.image_url %}
					<div class="cursor-pointer h-48 overflow-hidden" onclick="openModal({{ project.image_url | tojson }})">
						<img
							src="{{ project.image_url }}"
							alt="{{ project.title }} Thumbnail"
							class="w-full h-48 object-cover transition-transform duration-300 hover:scale-110"
							loading="lazy"
						/>
					</div>
					{% else %}
					<div class="h-48 overflow-hidden">
						<img
							src="https://via.placeholder.com/400x250"
							alt="{{ project.title }} Thumbnail - Placeholder"
							class="w-full h-48 object-cover"
							loading="lazy"
						/>
					</div>
					{% endif %}
					<div class="p-6">
						<h2
							class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-2"
							style="font-family: 'Geist Mono', monospace"
						>
							{{ project.title }}
						</h2>
						<div class="description-area mb-3 relative">
							{% if project.description %}
							<p
								class="text-gray-600 dark:text-gray-400 text-sm leading-relaxed project-description"
								style="font-family: 'Geist Mono', monospace"
							>
								{{ project.description }}
							</p>
							<div
								class="fade-overlay absolute bottom-0 left-0 right-0 h-6 bg-gradient-to-t from-white to-transparent dark:from-gray-800 pointer-events-none hidden z-10"
							></div>
							<button
								type="button"
								class="toggle-desc hidden relative z-20 text-blue-600 dark:text-blue-400 text-xs font-medium mt-1 hover:underline focus:outline-none focus:ring-2 focus:ring-blue-400/40 rounded"
							>
								Show more
							</button>
							{% else %}
							<p class="text-gray-600 dark:text-gray-400 text-sm italic">No description available.</p>
							{% endif %}
						</div>
						<!-- Technologies -->
						{% if project.technologies %}
						<div class="mb-4 flex flex-wrap gap-2">
							{% for tech in project.technologies %}
							<span
								class="inline-block bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-300 text-xs font-semibold px-2.5 py-0.5 rounded"
								style="font-family: 'Geist Mono', monospace"
								>{{ tech }}</span
							>
							{% endfor %}
						</div>
						{% endif %}
						<div class="flex space-x-4">
							{% if project.github_link %}
							<a
								href="{{ project.github_link }}"
								target="_blank"
								rel="noopener noreferrer"
								class="text-blue-500 hover:text-blue-700 dark:hover:text-blue-400 font-medium transition-colors duration-300"
								style="font-family: 'JetBrains Mono', monospace"
							>
								<i class="fab fa-github mr-1"></i> GitHub
							</a>
							{% endif %} {% if project.live_demo_link %}
							<a
								href="{{ project.live_demo_link }}"
								target="_blank"
								rel="noopener noreferrer"
								class="text-green-500 hover:text-green-700 dark:hover:text-green-400 font-medium transition-colors duration-300"
								style="font-family: 'JetBrains Mono', monospace"
							>
								<i class="fas fa-external-link-alt mr-1"></i> Live Demo
							</a>
							{% endif %}
						</div>
					</div>
				</div>
				{% endfor %}
			</div>
			{% else %}
			<div class="text-center py-12">
				<p class="text-gray-700 dark:text-gray-200 text-lg" style="font-family: 'Geist Mono', monospace">
					No projects have been added yet. Check back soon!
				</p>
			</div>
			{% endif %}
		</main>
		{% include 'footer.html' %}

		<!-- Image Modal -->
		<div
			id="imageModal"
			class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out"
		>
			<img
				id="modalImage"
				src=""
				alt="Project Image"
				class="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
			/>
			<span class="absolute top-4 right-6 text-white text-4xl cursor-pointer hover:text-gray-300" onclick="closeModal()"
				>&times;</span
			>
		</div>

		<script>
			function initDescriptions() {
				const cards = document.querySelectorAll('.description-area');
				cards.forEach((area) => {
					const p = area.querySelector('.project-description');
					const btn = area.querySelector('.toggle-desc');
					const fade = area.querySelector('.fade-overlay');
					if (!p || !btn || !fade) return;

					function clampIfNeeded() {
						// Reset state to measure natural height
						p.classList.remove('desc-clamped');
						fade.classList.add('hidden');
						btn.classList.add('hidden');
						btn.textContent = 'Show more';

						// Compute line-height and height to estimate lines
						const style = window.getComputedStyle(p);
						let lineHeight = parseFloat(style.lineHeight);
						if (isNaN(lineHeight)) {
							// Fallback when line-height is 'normal'
							const fontSize = parseFloat(style.fontSize) || 14;
							lineHeight = fontSize * 1.5;
						}
						const maxLines = 4;
						const maxHeight = lineHeight * maxLines;
						const needsClamp = p.scrollHeight > maxHeight + 1; // tolerance

						if (needsClamp) {
							p.classList.add('desc-clamped');
							fade.classList.remove('hidden');
							btn.classList.remove('hidden');
						}
					}

					clampIfNeeded();
					// Re-evaluate on resize to handle responsive line wrapping
					window.addEventListener('resize', clampIfNeeded);

					btn.addEventListener('click', () => {
						const isClamped = p.classList.contains('desc-clamped');
						if (isClamped) {
							p.classList.remove('desc-clamped');
							fade.classList.add('hidden');
							btn.textContent = 'Show less';
						} else {
							p.classList.add('desc-clamped');
							fade.classList.remove('hidden');
							btn.textContent = 'Show more';
						}
					});
				});
			}

			function openModal(imageUrl) {
				const modal = document.getElementById('imageModal');
				const modalImage = document.getElementById('modalImage');
				if (modal && modalImage) {
					modalImage.src = imageUrl;
					modal.classList.remove('opacity-0', 'pointer-events-none');
					modal.classList.add('opacity-100');
					document.body.style.overflow = 'hidden'; // Prevent background scrolling
				}
			}

			function closeModal() {
				const modal = document.getElementById('imageModal');
				if (modal) {
					modal.classList.remove('opacity-100');
					modal.classList.add('opacity-0', 'pointer-events-none');
					document.body.style.overflow = 'auto'; // Restore scrolling
					// It's good practice to clear the src after the transition or when opening next time
					// For simplicity, we'll let it be overwritten on next openModal call.
				}
			}

			document.addEventListener('DOMContentLoaded', () => {
				initDescriptions();
				const modalElement = document.getElementById('imageModal');

				if (modalElement) {
					// Close modal on escape key
					document.addEventListener('keydown', function (event) {
						if (event.key === 'Escape' && modalElement.classList.contains('opacity-100')) {
							closeModal();
						}
					});

					// Close modal when clicking on the background (the modalElement itself)
					modalElement.addEventListener('click', function (event) {
						if (event.target === modalElement) {
							closeModal();
						}
					});
				}
			});
		</script>
	</body>
</html>
